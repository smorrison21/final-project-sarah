```{python}
import geopandas as gpd
import altair as alt
import numpy as np
```
```{python}
usa_map = gpd.read_file("cb_2018_us_state_500k.zip")
preschool_stats = gpd.read_file('./data/preschool_stats.csv')
```

```{python}
usa_map.head()

#usa_map = usa_map.to_crs("EPSG:3857")

#usa_map['centroid'] = usa_map.geometry.centroid

usa_map = usa_map.rename(columns={
    'NAME': 'State Name',
    'GEOID': 'id'})
#usa_map['longitude'] = usa_map.centroid.x

#usa_map['latitude'] = usa_map.centroid.y

preschool_geometry = preschool_stats.merge(usa_map, on=['State Name'], how='inner')

preschool_geometry = gpd.GeoDataFrame(preschool_geometry, geometry=preschool_geometry['geometry'])

#preschool_geometry['geometry'] = preschool_geometry['geometry'].set_crs("EPSG:4326", allow_override=True)
print(preschool_geometry['geometry'].crs)


```

```{python}
from vega_datasets import data

states = alt.topo_feature(data.us_10m.url, 'states')
```

```{python}
alt.Chart(states).mark_geoshape().encode(
    color='Total State Pre-K Spending (2023 Dollars):Q'
).transform_lookup(
    lookup='id',
    from_=alt.LookupData(preschool_geometry, 'id', list(preschool_geometry.columns))
).properties(
    width=500,
    height=300
).project(
    type='albersUsa'
)
```

```{python}
preschool_geometry['Year'] = preschool_geometry['Year'].astype(str)

# make dataframe smaller
preschool_geometry.drop(
    ['Total All-Reported Spending (2023 Dollars)',
    'Number of 3-year-olds Enrolled in State Pre-K',
    'Number of 4-year-olds Enrolled in State Pre-K',
    'STATEFP',
    'STATENS',
    'AFFGEOID',
    'LSAD',
    'ALAND',
    'AWATER'
],  axis=1, 
    inplace=True
)
```

```{python}
folder_path = '.venv'
os.makedirs(folder_path, exist_ok=True)
file_path = os.path.join(folder_path, 'preschool_geometry.csv')
preschool_geometry.to_csv(file_path, index=False)
```